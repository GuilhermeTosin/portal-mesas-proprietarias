---
import Layout from '../layouts/Layout.astro';
import coupons from '../data/coupons.json';

// Tailwind classes mapping
const colorStyles = {
	blue: { bg: 'bg-blue-600', text: 'text-blue-600', hoverInfo: 'hover:text-blue-600', btnBg: 'bg-blue-600', btnHover: 'hover:bg-blue-700' },
	indigo: { bg: 'bg-indigo-600', text: 'text-indigo-600', hoverInfo: 'hover:text-indigo-600', btnBg: 'bg-indigo-600', btnHover: 'hover:bg-indigo-700' },
	purple: { bg: 'bg-purple-600', text: 'text-purple-600', hoverInfo: 'hover:text-purple-600', btnBg: 'bg-purple-600', btnHover: 'hover:bg-purple-700' },
	teal: { bg: 'bg-teal-600', text: 'text-teal-600', hoverInfo: 'hover:text-teal-600', btnBg: 'bg-teal-600', btnHover: 'hover:bg-teal-700' },
	red: { bg: 'bg-red-600', text: 'text-red-600', hoverInfo: 'hover:text-red-600', btnBg: 'bg-red-600', btnHover: 'hover:bg-red-700' },
	cyan: { bg: 'bg-cyan-600', text: 'text-cyan-600', hoverInfo: 'hover:text-cyan-600', btnBg: 'bg-cyan-600', btnHover: 'hover:bg-cyan-700' },
	orange: { bg: 'bg-orange-500', text: 'text-orange-500', hoverInfo: 'hover:text-orange-500', btnBg: 'bg-orange-500', btnHover: 'hover:bg-orange-600' },
	emerald: { bg: 'bg-emerald-600', text: 'text-emerald-600', hoverInfo: 'hover:text-emerald-600', btnBg: 'bg-emerald-600', btnHover: 'hover:bg-emerald-700' },
	fuchsia: { bg: 'bg-fuchsia-600', text: 'text-fuchsia-600', hoverInfo: 'hover:text-fuchsia-600', btnBg: 'bg-fuchsia-600', btnHover: 'hover:bg-fuchsia-700' }
};

// Fallback style iffirm color not specified or doesn't match
const defaultStyle = colorStyles.blue;
---

<Layout title="Todos os Cupons" description="Cupons de desconto exclusivos para as principais mesas proprietárias da indústria.">
	<div class="bg-gray-50 py-12 sm:py-20 lg:py-24 min-h-screen">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="text-center max-w-3xl mx-auto mb-16">
				<h1 class="text-3xl md:text-5xl font-extrabold text-gray-900 tracking-tight mb-4">
					Todos os <span class="text-blue-600">Cupons de Desconto</span>
				</h1>
				<p class="text-lg text-gray-500">
					Acesse nossa lista completa de promoções e economize na compra do seu próximo teste de avaliação em mesas proprietárias de Forex e Futuros.
				</p>
			</div>

			<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
				{coupons.map((coupon) => {
					const style = colorStyles[coupon.color || 'blue'] || colorStyles.blue;

					return (
						<div class="bg-white rounded-2xl shadow-lg border border-gray-100 overflow-hidden flex flex-col transition-transform hover:-translate-y-1 hover:shadow-xl">
							<div class={`h-2 ${style.bg}`}></div>
							<div class="p-8 flex-1 flex flex-col">
								<div class="flex justify-between items-start mb-4 gap-4">
									<h3 class="text-2xl font-bold text-gray-900 leading-tight">{coupon.company}</h3>
									<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-800 whitespace-nowrap flex-shrink-0 shadow-sm border border-green-200">
										{coupon.discount} OFF
									</span>
								</div>
								<p class="text-gray-500 mb-6 flex-1">{coupon.description || 'Desconto exclusivo para seguidores do Amazing Pro Traders.'}</p>
								
								<div class="mt-auto">
									<div class="bg-gray-50 rounded-lg p-4 flex items-center justify-between border border-gray-200 border-dashed">
										<code class={`text-lg font-mono font-bold ${style.text}`}>{coupon.code}</code>
										<button class={`text-gray-400 focus:outline-none transition-colors ${style.hoverInfo}`} title="Copiar cupom">
											<svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
												<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
											</svg>
										</button>
									</div>
									<p class="text-xs text-gray-400 mt-3 text-center">
										Válido até: <span class={coupon.expiration ? "text-red-500 font-medium" : "text-gray-400"}>{coupon.expiration || "Indeterminado"}</span>
									</p>
									<a href={coupon.link} target="_blank" rel="noopener noreferrer" class={`mt-4 w-full inline-flex justify-center items-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white ${style.btnBg} ${style.btnHover}`}>
										Pegar Desconto
									</a>
								</div>
							</div>
						</div>
					);
				})}
			</div>
		</div>
	</div>

	<!-- Mesma lógica de cópia da Home -->
	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const copyButtons = document.querySelectorAll('button[title="Copiar cupom"]');
			
			copyButtons.forEach(button => {
				button.addEventListener('click', async () => {
					const codeElement = button.parentElement?.querySelector('code');
					if (codeElement && codeElement.textContent) {
						try {
							await navigator.clipboard.writeText(codeElement.textContent);
							
							const originalHTML = button.innerHTML;
							button.innerHTML = `<svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>`;
							
							setTimeout(() => {
								button.innerHTML = originalHTML;
							}, 2000);
						} catch (err) {
							console.error('Falha ao copiar:', err);
						}
					}
				});
			});
		});
	</script>
</Layout>
