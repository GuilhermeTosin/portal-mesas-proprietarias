---
import Layout from '../layouts/Layout.astro';
import MarketSessions from '../components/MarketSessions.astro';
import MarketPrices from '../components/MarketPrices.astro';
import coupons from '../data/coupons.json';

// Tailwind classes mapping
const colorStyles = {
	blue: { bg: 'bg-blue-600', text: 'text-blue-600', border: 'border-blue-600', btn: 'bg-blue-600 hover:bg-blue-700', shadow: 'shadow-blue-900/20' },
	indigo: { bg: 'bg-indigo-600', text: 'text-indigo-600', border: 'border-indigo-600', btn: 'bg-indigo-600 hover:bg-indigo-700', shadow: 'shadow-indigo-900/20' },
	purple: { bg: 'bg-purple-600', text: 'text-purple-600', border: 'border-purple-600', btn: 'bg-purple-600 hover:bg-purple-700', shadow: 'shadow-purple-900/20' },
	teal: { bg: 'bg-teal-600', text: 'text-teal-600', border: 'border-teal-600', btn: 'bg-teal-600 hover:bg-teal-700', shadow: 'shadow-teal-900/20' },
	red: { bg: 'bg-red-600', text: 'text-red-600', border: 'border-red-600', btn: 'bg-red-600 hover:bg-red-700', shadow: 'shadow-red-900/20' },
	cyan: { bg: 'bg-cyan-600', text: 'text-cyan-600', border: 'border-cyan-600', btn: 'bg-cyan-600 hover:bg-cyan-700', shadow: 'shadow-cyan-900/20' },
	orange: { bg: 'bg-orange-500', text: 'text-orange-500', border: 'border-orange-500', btn: 'bg-orange-500 hover:bg-orange-600', shadow: 'shadow-orange-900/20' },
	emerald: { bg: 'bg-emerald-600', text: 'text-emerald-600', border: 'border-emerald-600', btn: 'bg-emerald-600 hover:bg-emerald-700', shadow: 'shadow-emerald-900/20' },
	fuchsia: { bg: 'bg-fuchsia-600', text: 'text-fuchsia-600', border: 'border-fuchsia-600', btn: 'bg-fuchsia-600 hover:bg-fuchsia-700', shadow: 'shadow-fuchsia-900/20' }
};

const base = import.meta.env.BASE_URL.replace(/\/$/, '');
---

<Layout title="Início">
	<!-- Hero Section -->
	<section class="relative bg-gray-900 bg-cover bg-center text-white overflow-hidden" style={`background-image: url('${base}/hero-bg.png');`}>
		<div class="absolute inset-0 bg-gradient-to-r from-gray-900/90 via-gray-900/70 to-gray-900/40"></div>
		<div class="max-w-7xl mx-auto px-8 sm:px-12 lg:px-24 py-32 md:py-40 relative z-10 flex flex-col items-start text-left">
			<div class="max-w-4xl">
				<h1 class="text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-extrabold tracking-tight mb-6 drop-shadow-lg leading-tight">
					Conquiste sua conta financiada com as melhores <span class="text-yellow-400">Mesas Proprietárias</span>.
				</h1>
				<p class="text-lg md:text-xl text-gray-200 mb-10 text-shadow-sm font-medium">
					Compare as principais mesas proprietárias do mercado de trade, consiga cupons de desconto exclusivos e inicie sua jornada para se tornar um trader financiado.
				</p>
				<div class="flex flex-col sm:flex-row justify-start gap-4">
					<a href="#cupons" class="bg-yellow-400 hover:bg-yellow-300 text-gray-900 font-bold px-8 py-3 rounded-full transition-transform transform hover:scale-105 shadow-xl">
						Ver Cupons
					</a>
					<a href={`${base}/comparativo`} class="bg-white/10 hover:bg-white/20 text-white font-semibold border border-white/30 backdrop-blur-md px-8 py-3 rounded-full transition-colors">
						Comparar Mesas
					</a>
				</div>
				</div>
			</div>
		</div>
	</section>

	<section class="bg-gray-50 pt-8 pb-8">
		<MarketSessions />
		<MarketPrices />
	</section>

	<!-- Coupons Section -->
	<section id="cupons" class="py-12 bg-gray-50">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="text-center mb-16">
				<h2 class="text-3xl font-extrabold text-gray-900 sm:text-4xl">Cupons de Desconto Exclusivos</h2>
				<p class="mt-4 text-xl text-gray-500">Economize nas taxas de avaliação com nossos parceiros oficiais.</p>
			</div>

			<div class="grid gap-8 md:grid-cols-2 lg:grid-cols-3">
				{coupons.filter(c => c.featured).slice(0, 3).map((coupon) => {
					const style = colorStyles[coupon.color || 'blue'] || colorStyles.blue;
					return (
						<div class="bg-white rounded-2xl shadow-xl overflow-hidden border border-gray-100 transition-transform hover:-translate-y-1 hover:shadow-2xl">
							<div class={`h-2 ${style.bg}`}></div>
							<div class="p-8">
								<div class="flex justify-between items-start mb-4 gap-4">
									<h3 class="text-2xl font-bold text-gray-900 leading-tight">{coupon.company}</h3>
									<span class="inline-flex items-center px-3 py-1 rounded-full text-xs font-bold bg-green-100 text-green-800 whitespace-nowrap flex-shrink-0 shadow-sm border border-green-200">
										{coupon.discount} OFF
									</span>
								</div>
								<p class="text-gray-500 mb-6 font-medium">{coupon.description || 'Desconto exclusivo para seguidores do Amazing Pro Traders.'}</p>
								<div class="bg-gray-50 rounded-lg p-4 flex items-center justify-between border border-gray-200 border-dashed">
									<code class={`text-lg font-mono font-bold ${style.text}`}>{coupon.code}</code>
									<button class="text-gray-400 hover:text-blue-600 focus:outline-none transition-colors" title="Copiar cupom">
										<svg class="h-6 w-6" fill="none" viewBox="0 0 24 24" stroke="currentColor">
											<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z" />
										</svg>
									</button>
								</div>
								<p class="text-xs text-gray-400 mt-3 text-center">
									Válido até: <span class={coupon.expiration ? "text-red-500 font-medium" : "text-gray-400"}>{coupon.expiration || "Indeterminado"}</span>
								</p>
								<a href={coupon.link} target="_blank" rel="noopener noreferrer" class={`mt-4 w-full inline-flex justify-center items-center px-4 py-2 border border-transparent rounded-lg shadow-sm text-sm font-medium text-white ${style.btn}`}>
									Pegar Desconto
								</a>
							</div>
						</div>
					);
				})}
			</div>

			<div class="mt-12 text-center">
				<a href={`${base}/cupons`} class="inline-flex items-center justify-center px-8 py-3 border border-gray-300 shadow-sm text-base font-medium rounded-full text-gray-700 bg-white hover:bg-gray-50 transition-colors hover:text-blue-600">
					Ver Todos os Cupons <span class="ml-2">→</span>
				</a>
			</div>
		</div>
	</section>

	<!-- CTA Section -->
	<section class="bg-white py-16">
		<div class="max-w-7xl mx-auto px-4 sm:px-6 lg:px-8">
			<div class="bg-blue-50 rounded-3xl px-6 py-12 md:p-16 text-center border border-blue-100">
				<h2 class="text-3xl font-bold text-blue-900 mb-4">Não sabe qual empresa escolher?</h2>
				<p class="text-lg text-blue-700 mb-8 max-w-2xl mx-auto">
					Verifique nossa tabela comparativa e analise preços, regras de drawdown, metas de lucro e tudo que você precisa saber antes de comprar seu desafio.
				</p>
				<a href={`${base}/comparativo`} class="inline-flex justify-center items-center px-8 py-3 border border-transparent text-base font-medium rounded-full text-white bg-blue-600 hover:bg-blue-700 shadow-md transition-transform hover:scale-105">
					Acessar Tabela Comparativa →
				</a>
			</div>
		</div>
	</section>

	<script>
		document.addEventListener('DOMContentLoaded', () => {
			const copyButtons = document.querySelectorAll('button[title="Copiar cupom"]');
			
			copyButtons.forEach(button => {
				button.addEventListener('click', async () => {
					const codeElement = button.parentElement?.querySelector('code');
					if (codeElement && codeElement.textContent) {
						try {
							await navigator.clipboard.writeText(codeElement.textContent);
							
							// Save original SVG to restore later
							const originalHTML = button.innerHTML;
							
							// Switch to checkmark
							button.innerHTML = `<svg class="h-6 w-6 text-green-500" fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7" /></svg>`;
							
							// Restore after 2 seconds
							setTimeout(() => {
								button.innerHTML = originalHTML;
							}, 2000);
						} catch (err) {
							console.error('Falha ao copiar:', err);
						}
					}
				});
			});
		});
	</script>
</Layout>
